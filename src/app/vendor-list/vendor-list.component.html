<div class="container mt-4">
  <!-- Category Filter -->
  <div class="d-flex justify-content-end mb-4">
    <select id="categoryFilter"
            class="form-select w-auto rounded-pill px-3 py-2 small shadow-sm"
            [(ngModel)]="selectedCategory"
            (change)="onCategoryChange()">
      <option value="">All Categories</option>
      <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
    </select>
  </div>

  <!-- Vendor Cards -->
  <div *ngIf="paginatedVendors.length > 0; else noData">
    <div class="row g-4">
      <div class="col-12" *ngFor="let vendor of paginatedVendors">
        <div class="card border-0 shadow-sm position-relative rounded-4">
          <span class="badge bg-success position-absolute top-0 end-0 m-2 px-3 py-1 rounded-pill text-uppercase small">
            {{ vendor.category }}
          </span>

          <div class="card-body d-flex align-items-center">
            <img [src]="vendor.portfolioBase64 || 'assets/default-profile.png'"
                 class="rounded-circle me-4 shadow"
                 style="width: 75px; height: 75px; object-fit: cover;" />
            <div class="flex-grow-1">
              <h5 class="mb-1 text-primary fw-semibold">{{ vendor.businessName }}</h5>
              <p class="mb-1 small"><strong>Email:</strong> {{ vendor.email }}</p>
              <p class="mb-1 small"><strong>Location:</strong> {{ vendor.location }}</p>
              <p class="mb-1 small"><strong>Experience:</strong> {{ vendor.yearsOfExperience }} years</p>

              <button class="btn btn-outline-primary btn-sm mt-2 rounded-pill px-3" (click)="openPanel(vendor)">View Profile</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination Controls -->
    <div class="d-flex justify-content-between align-items-center mt-4">
      <button class="btn btn-outline-secondary btn-sm rounded-pill px-4" (click)="goToPreviousPage()" [disabled]="currentPage === 1">Previous</button>
      <span class="fw-medium">Page {{ currentPage }}</span>
      <button class="btn btn-outline-secondary btn-sm rounded-pill px-4" (click)="goToNextPage()" [disabled]="(currentPage * pageSize) >= vendors.length">Next</button>
    </div>
  </div>

  <!-- No Data Message -->
  <ng-template #noData>
    <div class="text-center mt-5 text-muted fs-6">No vendors found.</div>
  </ng-template>

 <!-- Offcanvas Side Panel -->
  <!-- Vendor Profile Panel -->
<div class="offcanvas offcanvas-end show"
     tabindex="-1"
     [ngClass]="{ 'd-block': selectedVendor }"
     style="width: 600px; background-color: #1e1e2f; color: white; overflow-y: auto;"
     *ngIf="selectedVendor">

  <!-- Header -->
  <div class="offcanvas-header border-bottom border-secondary bg-dark text-white">
    <div class="d-flex align-items-center gap-3">
      <img [src]="selectedVendor?.portfolioBase64 || 'assets/default-profile.png'"
           class="rounded"
           style="width: 60px; height: 60px; object-fit: cover;" />
      <div>
        <h5 class="mb-0 fw-semibold">{{ selectedVendor?.businessName }}</h5>
        <small class="text-muted">{{ selectedVendor?.category }}</small>
      </div>

    </div>
    <button type="button" class="btn-close btn-close-white" (click)="closePanel()"></button>
  </div>

  <!-- Body -->
  <div class="offcanvas-body p-4">



    <!-- Address -->
    <div class="mb-3">
      <p class="mb-1 small text-muted">📍 Address</p>
      <p class="fw-medium">{{ selectedVendor?.location }}</p>
    </div>

    <!-- Phone -->
    <div class="mb-3">
      <p class="mb-1 small text-muted">📞 Phone</p>
      <p class="fw-medium">{{ selectedVendor?.phone }}</p>
    </div>

    <!-- Email -->
    <div class="mb-3">
      <p class="mb-1 small text-muted">📧 Email</p>
      <p class="fw-medium">{{ selectedVendor?.email }}</p>
    </div>

    <!-- Experience -->
    <div class="mb-3">
      <p class="mb-1 small text-muted">🕒 Experience</p>
      <p class="fw-medium">{{ selectedVendor?.yearsOfExperience }} years</p>
    </div>

    <!-- Service Description -->
    <div class="mb-3">
      <p class="mb-1 small text-muted">📝 Service Description</p>
      <p class="fw-medium">{{ selectedVendor?.serviceDescription || 'N/A' }}</p>
    </div>

    <!-- Services Offered -->
    <div *ngIf="selectedVendor?.services?.length" class="mb-3">
      <p class="mb-1 small text-muted">🔧 Services Offered</p>
      <div class="d-flex flex-wrap gap-2">
        <span *ngFor="let service of selectedVendor.services" class="badge rounded-pill bg-info text-dark">{{ service }}</span>
      </div>
    </div>

    <!-- Terms and Conditions -->
    <div class="mb-4">
      <p class="mb-1 small text-muted">📜 Terms & Conditions</p>
      <div class="bg-secondary p-2 rounded small text-white" style="max-height: 120px; overflow-y: auto;">
        {{ selectedVendor?.termsAndCondition || 'Not specified' }}
      </div>
    </div>

    <!-- PhotoWorks -->
    <div *ngIf="selectedVendor?.portfolioBase64?.length">
  <p><strong>PhotoWorks:</strong></p>
  <div class="d-flex flex-wrap gap-3">
    <img *ngFor="let photo of selectedVendor.portfolioBase64"
         [src]="'data:image/jpeg;base64,' + photo"
         class="img-thumbnail"
         style="width: 150px; height: 150px; object-fit: cover;" />
  </div>
</div>
    <!-- Certification Image -->
<div *ngIf="selectedVendor?.certificationImageBase64?.length">
  <p><strong>Certification:</strong></p>
  <div class="d-flex flex-wrap gap-3">
    <img *ngFor="let cert of selectedVendor.certificationImageBase64"
         [src]="'data:image/jpeg;base64,' + cert"
         class="img-thumbnail"
         style="width: 150px; height: 150px; object-fit: cover;" />
  </div>
</div>



    <!-- Add Review Button -->
<div class="review-section">
  <button class="btn btn-outline-dark rounded-pill mb-3" (click)="showReviewBox = !showReviewBox">
    Add Review
  </button>

 <!-- Review Box -->
<div *ngIf="showReviewBox" class="review-box mb-4 "style="background-color: #2c2c3c; padding: 20px; border-radius: 10px;">
  <label class="form-label">Give your rating:</label>
  <div class="stars">
    <span
      *ngFor="let star of [1, 2, 3, 4, 5]"
      (click)="setRating(star)"
      [ngStyle]="{
        color: star <= rating ? '#ffc107' : '#ccc',
        cursor: 'pointer',
        fontSize: '1.8rem',
        fontWeight: 'bold',
        marginRight: '8px'
      }"
    >★</span>
  </div>

  <textarea
    [(ngModel)]="reviewText"
    placeholder="Write your review..."
    class="form-control mt-3 mb-3"
    rows="3"
  ></textarea>

  <button class="btn btn-success rounded-pill" (click)="submitReview()">Submit</button>
</div>


  <div class="review-summary-container">

    <!-- Overall Rating -->
    <!-- <div class="overall-rating mb-3">
      <div class="score fs-2">{{ averageRating }}</div>
      <div class="stars text-warning fs-5">
        <ng-container *ngFor="let s of [1,2,3,4,5]">
          <span [class.fw-bold]="s <= getRounded(averageRating)">★</span>
        </ng-container>
      </div>
      <div class="total-reviews text-muted">{{ totalReviews }} reviews</div>
    </div> -->
    <!-- Overall Rating -->
    <div class="overall-rating mb-3">
  <div class="score fs-2">{{ averageRating }}</div>
  <div class="stars text-warning fs-5">
    <ng-container *ngFor="let s of [1,2,3,4,5]">
      <span [class.fw-bold]="s <= floorRating">★</span>
    </ng-container>
  </div>
  <div class="total-reviews text-muted">{{ totalReviews }} reviews</div>
</div>

    <!-- Rating Bars -->
    <div class="rating-bars mb-4">
      <div *ngFor="let star of [5,4,3,2,1]" class="d-flex align-items-center mb-1">
        <span class="me-2">{{ star }}</span>
        <div class="progress flex-grow-1">
          <div class="progress-bar bg-info" [style.width.%]="getPercentage(star)"></div>
        </div>
      </div>
    </div>

    <hr />

    <!-- Individual Reviews -->
    <!-- <div class="review-list">
      <div class="review d-flex mb-3" *ngFor="let review of reviews">
        <img [src]="review.avatar" class="rounded-circle me-3" style="width: 40px; height: 40px;" />
        <div>
          <div class="stars text-warning mb-1">
            <span *ngFor="let s of [1,2,3,4,5]" [class.fw-bold]="s <= review.rating">★</span>
          </div>
          <p [innerHTML]="formatReview(review.text)" class="mb-0 small text-light"></p>
        </div>
      </div>
    </div>

  </div>
</div> -->
<div class="review-list">
  <div class="review d-flex mb-3" *ngFor="let review of reviews">
    <!-- <img [src]="review.avatar" class="rounded-circle me-3" style="width: 40px; height: 40px;" /> -->
    <div>
      <!-- Star Rating -->
      <div class="stars text-warning mb-1">
        <span *ngFor="let s of [1,2,3,4,5]" [class.fw-bold]="s <= review.rating">★</span>
      </div>

      <!-- Review Text -->
      <p class="mb-0 small text-light">{{ review.review }}</p>

      <!-- Reviewer Email -->
      <small class="text-muted">— {{ review.userEmail }}</small>
    </div>
  </div>
</div>


    <!-- Action Buttons -->
    <div class="d-grid gap-2">
      <a *ngIf="selectedVendor?.website" [href]="selectedVendor.website" target="_blank" class="btn btn-outline-info rounded-pill">
        🌐 Visit Website
      </a>
      <button class="btn btn-outline-success rounded-pill">🧭 Get Directions</button>
      <button class="btn btn-outline-warning rounded-pill">📤 Share Profile</button>
      <button class="btn btn-outline-primary" (click)="goToChatTab()">💬 Chat with Vendor</button>
    </div>

  </div>
</div>

